<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Wicket Stuff Wiki : wicket-push</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Wicket Stuff Wiki : wicket-push
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Nov 20, 2010 by <font color="#0050B2">seb</font>.
				    </div>

				    <p><b><em>NOTE: this documentation applies to wicket push version 1.4.13 or higher.</em></b></p>


<p>The Wicketstuff.org wicket-push project provides support for <a href="http://en.wikipedia.org/wiki/Reverse_Ajax">Reverse AJAX</a> in Wicket applications and allows them to "push" partial Web page updates to the Web browser.</p>

<p>The push projects comes with two implementations:</p>
<ol>
	<li><b>push-timer:</b> a polling based approach where the web page continuously polls the server for page updates via AJAX (similar to AjaxSelfUpdatingTimerBehavior)</li>
	<li><b>push-cometd:</b> the web pages connects to the web application via a stateful <a href="http://cometd.org/">Cometd</a> channel on which the server sends update requests to the browser on demand. <b>Note</b>: Cometd requires the Servlet 3.0 specification.</li>
</ol>


<p>The general usage pattern of wicket-push is like this:</p>
<ol>
	<li>Instantiate a Push event handler containing the logic to update the UI when a Push event - usually an event raised by a background service, e.g. chat service - occurs.</li>
	<li>Obtain a reference to a Push service implementation in your Wicket Panel.</li>
	<li>Install a push channel with this push event handler into one of the panel's components. This will add a Push behavior to that component.</li>
	<li>You add a listener to your (asynchronous) background service and forward the raised events via the Push service to the Push event handler. This will ensure that the update code is handled in the right Wicket HTTP request thread.</li>
</ol>


<p>Here is an example:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">/*
 * panel constructor
 */
<span class="code-keyword">public</span> ChatPanel()
{
    <span class="code-comment">// setup UI components ...
</span>
    /*
     * 1. instantiate push event handler
     */
    IPushEventHandler handler = <span class="code-keyword">new</span> AbstractPushEventHandler&lt;Message&gt;()
    {
        <span class="code-keyword">public</span> void onEvent(<span class="code-keyword">final</span> AjaxRequestTarget target, <span class="code-keyword">final</span> Message message)
	{
                <span class="code-comment">// TODO your component update logic goes here...
</span>	}
    });

    /*
     * 2. obtain a reference to a Push service implementation
     */
    IPushService pushService = CometdPushService.get();

    /*
     * 3. install push channel into <span class="code-keyword">this</span> panel
     */
    IPushChannel&lt;Message&gt; pushChannel = pushService.installPushChannel(<span class="code-keyword">this</span>, handler);

    /*
     * 4. connect to the chat service and forward the Message events
     */
    IChatService chatService = ServiceLocator.getChatService();
    chatService.addListener(<span class="code-keyword">new</span> IChatListener() {
        <span class="code-keyword">public</span> void onMessage(Message msg)
        {
            <span class="code-keyword">if</span> (pushService.isConnected(pushChannel))
                <span class="code-comment">// forward the Message event via the push service to the push event handler
</span>                pushService.publish(pushChannel, msg);
            <span class="code-keyword">else</span>
                chatService.removeListener(<span class="code-keyword">this</span>);
        }
    });
}</pre>
</div></div>

				    
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://wicketstuff.org/confluence/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Apr 11, 2011 12:08</font></td>
		    </tr>
	    </table>
    </body>
</html>