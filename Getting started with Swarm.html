<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Wicket Stuff Wiki : Getting started with Swarm</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Wicket Stuff Wiki : Getting started with Swarm
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Jul 19, 2009 by <font color="#0050B2">olger</font>.
				    </div>

				    <h1><a name="GettingstartedwithSwarm-GettingstartedwithSwarm"></a>Getting started with Swarm</h1>

<p>This section will show you how to get started as soon as possible using Swarm. If you feel there are certain things you must do differently, you should check the <a href="Swarm FAQ.html" title="Swarm FAQ">FAQ</a> or ask the wicket mailing list.</p>

<h2><a name="GettingstartedwithSwarm-TheWebApplication"></a>The WebApplication</h2>

<p>The easiest way is to let your web app extend SwarmWebApplication as it takes care of most of the grunt work for you.</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">package</span> org.apache.wicket.security.examples.multilogin;

.......
<span class="code-keyword">public</span> class MyApplication <span class="code-keyword">extends</span> SwarmWebApplication
{
    <span class="code-keyword">public</span> MyApplication()
    {
    }

    /**
     * @see org.apache.wicket.security.swarm.SwarmWebApplication#getHiveKey()
     */
    <span class="code-keyword">protected</span> <span class="code-object">Object</span> getHiveKey()
    {
        <span class="code-comment">// TODO Auto-generated method stub
</span>        <span class="code-keyword">return</span> <span class="code-keyword">null</span>;

    }

    /**
     * @see org.apache.wicket.security.swarm.SwarmWebApplication#setUpHive()
     */
    <span class="code-keyword">protected</span> void setUpHive()
    {
        <span class="code-comment">// TODO Auto-generated method stub
</span>    }

    /**
     * @see org.apache.wicket.Application#getHomePage()
     */
    <span class="code-keyword">public</span> <span class="code-object">Class</span> getHomePage()
    {
        <span class="code-comment">// TODO Auto-generated method stub
</span>        <span class="code-keyword">return</span> <span class="code-keyword">null</span>;
    }

    /**
     * @see org.apache.wicket.security.WaspApplication#getLoginPage()
     */
    <span class="code-keyword">public</span> <span class="code-object">Class</span> getLoginPage()
    {
        <span class="code-comment">// TODO Auto-generated method stub
</span>        <span class="code-keyword">return</span> <span class="code-keyword">null</span>;
    }

}</pre>
</div></div>
<p>There are 4 methods you must provide (one of them is already required by wicket anyway):</p>
<ol>
	<li>getHiveKey(): All Swarm applications use a hive, most of them are the only ones using that hive, but it is possible to share your hive between multiple applications in the same vm. Hives are stored and accessed by a key and swarm needs to know what that key is. I suggest you use the contextname of you're web app, if you are using servlet-api 2.5 you could do <em>return getServletContext().getContextPath();</em> If you are not you could set some init-params in the web.xml and read those or hardcode something. Just remember if you hardcode a key and your app gets deployed twice they will be using the same key and thus sharing the hive, which might not be what you want.</li>
	<li>setupHive(): This gives you the chance to register the hive. If you are the only one using this hive this is required, if you are sharing this hive, you need to check first if the hive was not already registered, as the registry does not allow you to register multiple hives with the same key.</li>
	<li>getHomePage(): This is already required by wicket, it is the page you see when no other page is specified in the url. This can be both a secure page or a regular page, if it is a secure page you will be redirected to the login page, see below.</li>
	<li>getLoginPage(): This is the default page for authenticating users, if you need to use multi-login with multiple different login pages you need to specify the one for the lowest user class (in effect the page where every user has to login anyway).</li>
</ol>


<p>So our application could look like this:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">package</span> org.apache.wicket.security.examples.multilogin;

...... <span class="code-keyword">public</span> class MyApplication <span class="code-keyword">extends</span> SwarmWebApplication
{

    <span class="code-keyword">public</span> MyApplication()
    {

    }

    /**
     * @see org.apache.wicket.security.swarm.SwarmWebApplication#getHiveKey()
     */
    <span class="code-keyword">protected</span> <span class="code-object">Object</span> getHiveKey()
    {
        <span class="code-comment">//<span class="code-keyword">if</span> you are using servlet api 2.5 i would suggest using:
</span>        <span class="code-comment">//<span class="code-keyword">return</span> getServletContext().getContextPath();
</span>
        <span class="code-comment">//<span class="code-keyword">if</span> not you have several options:
</span>        <span class="code-comment">//-an initparam in web.xml
</span>        <span class="code-comment">//-a <span class="code-keyword">static</span> object
</span>        <span class="code-comment">//-a random object
</span>        <span class="code-comment">//-whatever you can think of
</span>
        <span class="code-comment">//<span class="code-keyword">for</span> <span class="code-keyword">this</span> example we will be using a fixed string
</span>        <span class="code-keyword">return</span> <span class="code-quote">"multi-login"</span>;

    }

    /**
     * @see org.apache.wicket.security.swarm.SwarmWebApplication#setUpHive()
     */
    <span class="code-keyword">protected</span> void setUpHive()
    {
        <span class="code-comment">//create factory
</span>        <span class="code-comment">// For 1.4 use <span class="code-keyword">new</span> SwarmPolicyFileHiveFactory(getActionFactory());
</span>        PolicyFileHiveFactory factory = <span class="code-keyword">new</span> PolicyFileHiveFactory();

        <span class="code-keyword">try</span>
        {
            <span class="code-comment">//<span class="code-keyword">this</span> example uses 1 policy file but you can add as many as you like
</span>            factory.addPolicyFile(getServletContext().getResource(<span class="code-quote">"/WEB-INF/multilogin.hive"</span>));
        }
        <span class="code-keyword">catch</span> (MalformedURLException e)
        {
            <span class="code-keyword">throw</span> <span class="code-keyword">new</span> WicketRuntimeException(e);
        }
        <span class="code-comment">//register factory
</span>        HiveMind.registerHive(getHiveKey(), factory);
        <span class="code-comment">//note we are not checking <span class="code-keyword">if</span> a hive already exist because <span class="code-keyword">this</span> app will only be deployed once
</span>    }

    /**
     * @see org.apache.wicket.Application#getHomePage()
     */
    <span class="code-keyword">public</span> <span class="code-object">Class</span> getHomePage()
    {
        <span class="code-keyword">return</span> HomePage.class;
    }

    /**
     * @see org.apache.wicket.security.WaspApplication#getLoginPage()
     */
    <span class="code-keyword">public</span> <span class="code-object">Class</span> getLoginPage()
    {
        <span class="code-keyword">return</span> LoginPage.class;
    }

}</pre>
</div></div>

<h2><a name="GettingstartedwithSwarm-%26nbsp%3BTheHive"></a>&nbsp;The Hive</h2>

<p>&nbsp;As you can see we instructed our factory to configure our hive based on a file.</p>

<p>For those of you familiar with JAAS, you will find the structure strikingly similar.</p>

<p>It lays out a number of Principals each containing Permissions for components or models or something you thought of.</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">grant
{
    permission org.apache.wicket.security.hive.authorization.permissions.ComponentPermission <span class="code-quote">"org.apache.wicket.security.examples.multilogin.pages.HomePage"</span>, <span class="code-quote">"inherit, render"</span>;
    permission org.apache.wicket.security.hive.authorization.permissions.ComponentPermission <span class="code-quote">"org.apache.wicket.security.examples.multilogin.pages.HomePage"</span>, <span class="code-quote">"enable"</span>;
};</pre>
</div></div>
<p>What we just did is grant everyone the right to see (render) our HomePage, if there are secure components on the homepage we can see them too (inherit). In addition we granted links <b>to</b> our homepage the right to be clicked (enable). Because we do not want to give links <b>on</b> our homepage the right to be clicked we did not place the enable action on the previous line with the inherit. If we know for a fact that there are absolutely no links pointing to the homepage we could delete the second line, but generally you will want these two lines for any given secure page.</p>

<p>The following example might show more clear what i mean with the above.&nbsp; Suppose i have put a SecurePageLink on my homepage pointing to PageA. Given our previous policy the link will never be rendered because it lacks the render action for PageA. So if we change our policy to this.</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">grant
{
	permission org.apache.wicket.security.hive.authorization.permissions.ComponentPermission <span class="code-quote">"org.apache.wicket.security.examples.multilogin.pages.HomePage"</span>, <span class="code-quote">"inherit, render"</span>;
	permission org.apache.wicket.security.hive.authorization.permissions.ComponentPermission <span class="code-quote">"org.apache.wicket.security.examples.multilogin.pages.HomePage"</span>, <span class="code-quote">"enable"</span>;
	permission org.apache.wicket.security.hive.authorization.permissions.ComponentPermission <span class="code-quote">"org.apache.wicket.security.examples.multilogin.pages.PageA"</span>, <span class="code-quote">"inherit, render"</span>;
};</pre>
</div></div>
<p>The link to PageA will now be rendered, however because we did not grant the enable action wicket will render the link disabled (by default&nbsp; wicket converts it to a span tag) so you cannot click the link. So if we make one final change to our policy.</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">grant
{
	permission org.apache.wicket.security.hive.authorization.permissions.ComponentPermission <span class="code-quote">"org.apache.wicket.security.examples.multilogin.pages.HomePage"</span>, <span class="code-quote">"inherit, render"</span>;
	permission org.apache.wicket.security.hive.authorization.permissions.ComponentPermission <span class="code-quote">"org.apache.wicket.security.examples.multilogin.pages.HomePage"</span>, <span class="code-quote">"enable"</span>;
	permission org.apache.wicket.security.hive.authorization.permissions.ComponentPermission <span class="code-quote">"org.apache.wicket.security.examples.multilogin.pages.PageA"</span>, <span class="code-quote">"inherit, render"</span>;
	permission org.apache.wicket.security.hive.authorization.permissions.ComponentPermission <span class="code-quote">"org.apache.wicket.security.examples.multilogin.pages.PageA"</span>, <span class="code-quote">"enable"</span>;
};</pre>
</div></div>
<p>This will render the link such that it can be clicked. For those of you wanting to read more about this, i have described it in more detail and with an alternative on the wicket mailing list <a href="http://www.nabble.com/Wicket-Security-Configuration-Question-tf3884414.html#a11009846">here</a>. Note that the inherit action in "inherit, render" is not strictly required but it usually is a good idea to put it there as it allows all secure components on the HomePage to inherit the render action (see alternative on the mailing list for more details).</p>

<p>If you think, what a long line isn't there a shorter way, then i have good news for you. Hive supports aliases. This means that besides the build in aliases for permissions you can add your own aliases for permissions, principals and names, just not for actions&#33;. aliases can be concatenated but not nested. so if we rewrite our policy to use aliases we get</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">grant
{
    permission ${ComponentPermission} <span class="code-quote">"${hp}"</span>, <span class="code-quote">"inherit, render"</span>;
    permission ${ComponentPermission} <span class="code-quote">"${hp}"</span>, <span class="code-quote">"enable"</span>;
};</pre>
</div></div>
<p>${ComponentPermission} is a build in permission but ${hp} is not so we need to define our alias like this
<br clear="all" /></p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">protected</span> void setUpHive()
    {
        <span class="code-comment">//create factory
</span>        PolicyFileHiveFactory factory = <span class="code-keyword">new</span> PolicyFileHiveFactory();
        <span class="code-keyword">try</span>
        {
            <span class="code-comment">//<span class="code-keyword">this</span> example uses 1 policy file but you can add as many as you like
</span>            factory.addPolicyFile(getServletContext().getResource(<span class="code-quote">"/WEB-INF/multilogin.hive"</span>));	    factory.setAlias(<span class="code-quote">"hp"</span>, <span class="code-quote">"org.apache.wicket.security.examples.multilogin.pages.HomePage"</span>);
        }
        <span class="code-keyword">catch</span> (MalformedURLException e)
        {
            <span class="code-keyword">throw</span> <span class="code-keyword">new</span> WicketRuntimeException(e);
        }
        <span class="code-comment">//register factory
</span>        HiveMind.registerHive(getHiveKey(), factory);
        <span class="code-comment">//note we are not checking <span class="code-keyword">if</span> a hive already exist because <span class="code-keyword">this</span> app will only be deployed once
</span>    }</pre>
</div></div>

<h2><a name="GettingstartedwithSwarm-Pages"></a>Pages</h2>

<p>&nbsp;Earlier i mentioned secure pages and regular pages. What i meant with those is this:</p>

<p>Secure pages are pages requiring an authenticated user with certain privileges.</p>

<p>Regular pages are pages anyone can see.</p>

<p>In swarm you achieve this by having the secure pages either extend SecureWebPage or implement ISecurePage. By default every page that is an instance of ISecurePage needs to have a logged in user or the user will be redirected to the login page. Although swarm provides ways for you to customize the class that is checked, it is unlikely you will need to change this default behavior. Off course having the loginpage implement ISecurePage is <b>not</b> a good idea.</p>

<h2><a name="GettingstartedwithSwarm-Authenticationandauthorization%26nbsp%3B"></a>Authentication and authorization&nbsp;</h2>

<p>There are many frameworks for authenticating, all of them should be relatively easy to use with swarm and some of them will no doubt be made available by default in swarm. Thus minimizing the effort on your side but until they are available you will need to get your hands dirty <img class="emoticon" src="images/icons/emoticons/smile.gif" height="20" width="20" align="absmiddle" alt="" border="0"/></p>

<p>&nbsp;I will show authentication in a moment, lets focus on authorization first.</p>


<p>Authorization in swarm is handled by permissions and principals. principals are used to group permissions and are granted to users. permissions are never granted to users but are instead defined by the system. as shown swarm stores them in a policy file by default. Once you get to know the full power of principals you may want to build your own by implementing&nbsp; the Principal interface, but for now you can use SimplePrincipal. As the name suggests it is very simple and does not use any of the advanced features like principal inheritance. Note that although it is not shown here the class and name of the principal can be aliased too.</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">.......
grant principal org.apache.wicket.security.hive.authorization.SimplePrincipal <span class="code-quote">"basic"</span>
{
	permission ${ComponentPermission} <span class="code-quote">"org.apache.wicket.security.examples.multilogin.pages.BankAccountBalancePage"</span>, <span class="code-quote">"inherit, render"</span>;
	permission ${ComponentPermission} <span class="code-quote">"org.apache.wicket.security.examples.multilogin.pages.BankAccountBalancePage"</span>, <span class="code-quote">"enable"</span>;
	permission ${ComponentPermission} <span class="code-quote">"org.apache.wicket.security.examples.multilogin.pages.InitiateTransferMoneyPage"</span>, <span class="code-quote">"inherit, render"</span>;
	permission ${ComponentPermission} <span class="code-quote">"org.apache.wicket.security.examples.multilogin.pages.InitiateTransferMoneyPage"</span>, <span class="code-quote">"enable"</span>;
};</pre>
</div></div>
<p>By dividing our pages over several principals we can establish a firm base for a role based secure application.</p>

<p>Now we are ready to grant users some principals. The easiest way to login (or logoff for that matter) is through the session. The (Wasp)session has a login method that accepts any object passed in. Swarm is a little bit more picky and requires a LoginContext. A LoginContext is nothing more then a callback function to get the user. LoginContexts are throw away obects and therefor ideal for storing user credentials (like passwords) you don't want hanging around in your session. For more advanced stuff you will want to extend LoginContext directly but for the simple username password stuff you can extend UsernamePasswordContext</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">public</span> class MyContext <span class="code-keyword">extends</span> UsernamePasswordContext
{
  	<span class="code-keyword">public</span> MyContext(<span class="code-object">String</span> username, <span class="code-object">String</span> password)
	{
 		<span class="code-keyword">super</span>(username, password);
 	}
 	/**
	 * @see org.apache.wicket.security.hive.authentication.UsernamePasswordContext#getSubject(<span class="code-object">String</span>, <span class="code-object">String</span>)
	 */
	<span class="code-keyword">protected</span> <span class="code-keyword">abstract</span> Subject getSubject(<span class="code-object">String</span> username, <span class="code-object">String</span> password) <span class="code-keyword">throws</span> LoginException;
	{
 		<span class="code-comment">//authenticate username, password, <span class="code-keyword">throw</span> exception <span class="code-keyword">if</span> not found
</span>		......
		DefaultSubject user=<span class="code-keyword">new</span> DefaultSubject();
		<span class="code-comment">//grant principals: (user.addPrincipal(Principal))
</span>		<span class="code-comment">//Note Subjects are read only, but implementations like DefaultSubject will usually have some sort of way <span class="code-keyword">for</span> you to add principals. Implementations are required to honor the readonly flag which swarm sets immediately after obtaining the subject.
</span>		....

		<span class="code-keyword">return</span> user;
 	}
}</pre>
</div></div>
<p>Please note that you should not create anonymous subclasses of Subjects in the LoginContext because if the subject is serialized along with the session and being an anonymous subclass it would also cause the LoginContext to be serialized. Instead create a static named subclass.</p>

<h2><a name="GettingstartedwithSwarm-%26nbsp%3BActions"></a>&nbsp;Actions</h2>

<p>The default actions access, inherit, render and enable might not be enough for you. You might want to make your own custom actions. This is where the ActionFactory comes in. Suppose i want to use actions to create a vertical authorization separation between my users / rights. For example if i have a principal "edit staff personalia" and for some users this principal applies to the entire organization whereas for other users it only applies to staff for there own department.</p>

<p>First we need to define our actions</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">/**
 * Represents actions granted at the department level.
 */
<span class="code-keyword">public</span> <span class="code-keyword">interface</span> Department <span class="code-keyword">extends</span> WaspAction
{
}
/**
 * Represents actions granted at the organization level.
 */
<span class="code-keyword">public</span> <span class="code-keyword">interface</span> Organization <span class="code-keyword">extends</span> WaspAction
{
}</pre>
</div></div>
<p>Next we need to use these in our actionfactory.</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">public</span> class MyActionFactory <span class="code-keyword">extends</span> SwarmActionFactory
{

    /**
     * Constructs a <span class="code-keyword">new</span> ActionFactory with in addition to the <span class="code-keyword">default</span> actions, organisation and department actions.
     */
    <span class="code-keyword">public</span> MyActionFactory()
    {
        <span class="code-keyword">super</span>();
        <span class="code-keyword">try</span>
        {
            <span class="code-comment">//note none of the actions registered <span class="code-keyword">this</span> way will implement the <span class="code-keyword">interface</span> defined here, you will simply get the <span class="code-keyword">default</span> action
</span>            register(Department.class,<span class="code-quote">"department"</span>);
            <span class="code-comment">//registering an action <span class="code-keyword">this</span> way will <span class="code-keyword">return</span> the actual implementation specified here
</span>            <span class="code-comment">//however the reason we are using a custom implementation here is because we need to inherit the department action
</span>            register(Organisation.class, <span class="code-keyword">new</span> ImpliesOtherAction(nextPowerOf2(),<span class="code-quote">"organization"</span>,<span class="code-keyword">this</span>,Department.class));

        }
        <span class="code-keyword">catch</span> (RegistrationException e)
        {
            <span class="code-keyword">throw</span> <span class="code-keyword">new</span> WicketRuntimeException(<span class="code-quote">"actionfactory was not setup correctly"</span>,e);
        }
    }
}</pre>
</div></div>
<p>The ImpliesOtherAction comes with swarm and allows your action (Organisation in this case) to imply 1 or more previously registered actions.</p>


<p>Now that we have registered our actions we can start using them in our ISecurityChecks. In the following example i chose to extend the securitycheck for links allowing me to hide / show links whether a user has organization or department rights.</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">public</span> class DepartmentLinkCheck <span class="code-keyword">extends</span> LinkSecurityCheck
{
    <span class="code-keyword">private</span> <span class="code-keyword">static</span> <span class="code-keyword">final</span> <span class="code-object">long</span> serialVersionUID = 1L;

    <span class="code-keyword">private</span> <span class="code-object">boolean</span> secureDepartment;

    /**
     * Construct.
     * @param component
     * @param clickTarget
     */
    <span class="code-keyword">public</span> DepartmentLinkCheck(AbstractLink component, <span class="code-object">Class</span> clickTarget, Department department)
    {
        <span class="code-keyword">super</span>(component, clickTarget);
        secureDepartment = department.secure;
       <span class="code-comment">//our department entity has a flag letting us know <span class="code-keyword">if</span> it should be <span class="code-keyword">protected</span> or not, but you could ofcourse base the decision on anything you like
</span>    }

    ......

    /**
     * @see org.apache.wicket.security.checks.LinkSecurityCheck#isActionAuthorized(org.apache.wicket.security.actions.WaspAction)
     */
    <span class="code-keyword">public</span> <span class="code-object">boolean</span> isActionAuthorized(WaspAction action)
    {
<span class="code-comment">//        <span class="code-keyword">for</span> secure departments you need organization rights, <span class="code-keyword">else</span> department rights are sufficient
</span>        WaspAction myAction = action.add(getActionFactory().getAction(
                secureDepartment ? Organization.class : org.apache.wicket.security.examples.customactions.authorization.Department.class));
        <span class="code-comment">//<span class="code-keyword">this</span> is as easy as adding the required actions and then let the <span class="code-keyword">super</span> implementation take over.
</span>        <span class="code-keyword">return</span> <span class="code-keyword">super</span>.isActionAuthorized(myAction);
    }

}</pre>
</div></div>
<p>Besides using a custom security check you can also use your custom actions in secure models.</p>

<h2><a name="GettingstartedwithSwarm-Securemodels"></a>Secure models</h2>

<p>Secure models can be used if you want to have many components using the same check, so instead of assigning a securitycheck to each of them you could use a SwarmCompoundPropertyModel on a shared parent component and authorization is automatically handled.</p>

<p>By default Wasp first checks if a component has been assigned a security check and ifso the check has the final say, if no check is found the model of the component is inspected, if it is a subclass of ISecureModel the model has the final say. This does not mean you can not use security checks an secure models together, you just need to have the securitycheck also check the model. For example ComponentSecurityCheck offers this option. In your policy you need to grant a DataPermission instead of a ComponentPermission like this.</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">permission ${DataPermission} <span class="code-quote">"department"</span>, <span class="code-quote">"inherit, render, department"</span>;</pre>
</div></div>
<p>The name of the permission "department" is specified in the secure model and is nothing more than a reference, like the id of a component. To conclude this getting started some code showing a secure model with cutom actions.</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">public</span> class DepartmentModel <span class="code-keyword">extends</span> SwarmCompoundPropertyModel
{
    <span class="code-keyword">private</span> <span class="code-keyword">static</span> <span class="code-keyword">final</span> <span class="code-object">long</span> serialVersionUID = 1L;

    /**
     * Construct.
     *
     * @param object
     */
    <span class="code-keyword">public</span> DepartmentModel(<span class="code-object">Object</span> object)
    {
        <span class="code-keyword">super</span>(object);
    }

    /**
     * @see org.apache.wicket.security.swarm.models.SwarmModel#getSecurityId(org.apache.wicket.Component)
     */
    <span class="code-keyword">public</span> <span class="code-object">String</span> getSecurityId(Component component)
    {
        <span class="code-keyword">return</span> <span class="code-quote">"department"</span>; <span class="code-comment">//remember the name of the datapermission? <span class="code-keyword">this</span> is it
</span>    }

    /**
     * @see org.apache.wicket.security.models.ISecureModel#isAuthorized(org.apache.wicket.Component,
     *      org.apache.wicket.security.actions.WaspAction)
     */
    <span class="code-keyword">public</span> <span class="code-object">boolean</span> isAuthorized(Component component, WaspAction action)
    {
        WaspAction myAction=action;
        <span class="code-object">Object</span> obj = getObject();
        <span class="code-comment">//the department entity not to be confused with the department action further down.
</span>        <span class="code-keyword">if</span> (obj <span class="code-keyword">instanceof</span> Department)
        {
            Department department = (Department)obj;
<span class="code-comment">//            <span class="code-keyword">for</span> secure departments you need organization rights, <span class="code-keyword">else</span> department rights are sufficient
</span>            myAction = action.add(getActionFactory().getAction(
                    department.secure ? Organization.class : org.apache.wicket.security.examples.customactions.authorization.Department.class));
        }
        <span class="code-keyword">return</span> <span class="code-keyword">super</span>.isAuthorized(component, myAction);
    }

}</pre>
</div></div>

<h2><a name="GettingstartedwithSwarm-%26nbsp%3BTheend"></a>&nbsp;The end</h2>

<p>Questions?<br/>
Comments?</p>

				    
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://wicketstuff.org/confluence/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Apr 11, 2011 12:08</font></td>
		    </tr>
	    </table>
    </body>
</html>